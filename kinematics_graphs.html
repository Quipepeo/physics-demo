<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kinematics Simulator</title>

  <!-- Chart.js and DragData plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-dragdata@2.0.0/dist/chartjs-plugin-dragdata.min.js"></script>

  <style>
    body { font-family: sans-serif; margin: 20px; }
    h1 { text-align: center; }

    #controls {
      max-width: 800px;
      margin: 0 auto 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      align-items: end;
    }

    #controls label { font-weight: bold; display: block; margin-bottom: 4px; }
    #controls input[type="number"] { width: 100%; }

    #buttons { grid-column: span 2; text-align: center; margin-top: 10px; }

    #charts {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .chart-container {
      flex: 1 1 300px;
      max-width: 380px;
      position: relative;
    }

    .chart-container canvas {
      width: 100% !important;
      height: auto !important;
    }

    .axis-signs {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      font-size: 1.2em;
      color: #555;
    }

    .axis-signs .py-plus  { position: absolute; left: 4px; top: 4px; }
    .axis-signs .py-minus { position: absolute; left: 4px; bottom: 4px; }
    .axis-signs .px-plus  { position: absolute; right: 4px; bottom: 4px; }
  </style>

  <script>
    Chart.register(ChartDragDataPlugin);
  </script>
</head>
<body>
  <h1>Kinematics Simulator</h1>

  <div id="controls">
    <div><label for="x0">Initial Position x₀ (m)</label><input type="number" id="x0" value="0" step="0.1"></div>
    <div><label for="v0">Initial Velocity v₀ (m/s)</label><input type="number" id="v0" value="5" step="0.1"></div>
    <div><label for="duration">Duration (s)</label><input type="number" id="duration" value="5" step="1"></div>
    <div><label for="dt">Time Step Δt (s)</label><input type="number" id="dt" value="0.1" step="0.01"></div>
    <div>
      <label><input type="checkbox" id="showPos" checked> Show Position</label>
      <label><input type="checkbox" id="showVel" checked> Show Velocity</label>
    </div>
    <div id="buttons">
      <button id="updateBtn">Update Graphs</button>
      <button id="resetBtn">Start Over</button>
    </div>
  </div>

  <div id="charts"><script>
  function linspace(start, stop, step) {
    const arr = [];
    for (let x = start; x <= stop + 1e-9; x += step) {
      arr.push(+x.toFixed(6));
    }
    return arr;
  }

  let posChart, velChart, accChart;
  let accPts = [];

  function chartOptions() {
    return {
      animation: false,
      responsive: true,
      scales: {
        x: { grid: { display: false }, ticks: { display: false } },
        y: {
          grid: {
            color: ctx => ctx.tick.value === 0 ? '#000' : 'transparent',
            lineWidth: 1
          },
          ticks: { display: false }
        }
      },
      plugins: {
        legend: { display: false },
        dragData: {
          round: 0.1,
          showTooltip: true,
          onDrag: (e, dsIndex, index, value) => {
            const id = e.chart.canvas.id;
            if (id === 'posChart' && index === 0) {
              document.getElementById('x0').value = value.y;
              updateAll();
            }
            if (id === 'velChart' && index === 0) {
              document.getElementById('v0').value = value.y;
              updateAll();
            }
            if (id === 'accChart') {
              accPts[index] = value.y;
              updateAll();
            }
          }
        }
      }
    };
  }

  function initCharts() {
    posChart = new Chart(document.getElementById('posChart'), {
      type: 'line',
      data: { datasets: [{
        label: 'x(t)', data: [], borderColor: 'blue',
        pointRadius: ctx => ctx.dataIndex === 0 ? 6 : 0,
        pointBackgroundColor: 'blue', showLine: true
      }]},
      options: { ...chartOptions(), plugins: { ...chartOptions().plugins, dragData: { ...chartOptions().plugins.dragData, dragX: false } } }
    });

    velChart = new Chart(document.getElementById('velChart'), {
      type: 'line',
      data: { datasets: [{
        label: 'v(t)', data: [], borderColor: 'green',
        pointRadius: ctx => ctx.dataIndex === 0 ? 6 : 0,
        pointBackgroundColor: 'green', showLine: true
      }]},
      options: { ...chartOptions(), plugins: { ...chartOptions().plugins, dragData: { ...chartOptions().plugins.dragData, dragX: false } } }
    });

    accChart = new Chart(document.getElementById('accChart'), {
      type: 'line',
      data: { datasets: [{
        label: 'a(t)', data: [], borderColor: 'red',
        pointRadius: 6, pointBackgroundColor: 'red',
        showLine: true, stepped: true
      }]},
      options: { ...chartOptions(), plugins: { ...chartOptions().plugins, dragData: { ...chartOptions().plugins.dragData, dragX: true } } }
    });
  }

  function computeKinematics(x0, v0, accPts, duration, dt) {
    const tArr = linspace(0, duration, dt);
    const aArr = tArr.map(t => accPts[Math.floor(t)]);
    const vArr = [v0], xArr = [x0];
    for (let i = 1; i < tArr.length; i++) {
      const a = aArr[i - 1];
      const v = vArr[i - 1] + a * dt;
      vArr.push(v);
      const x = xArr[i - 1] + vArr[i - 1] * dt + 0.5 * a * dt * dt;
      xArr.push(x);
    }
    return { tArr, xArr, vArr };
  }

    function updateAll() {
    const x0 = +document.getElementById('x0').value;
    const v0 = +document.getElementById('v0').value;
    const duration = +document.getElementById('duration').value;
    const dt = +document.getElementById('dt').value;
    const showPos = document.getElementById('showPos').checked;
    const showVel = document.getElementById('showVel').checked;

    if (accPts.length !== duration + 1) {
      accPts = Array(duration + 1).fill(1);
    }

    const { tArr, xArr, vArr } = computeKinematics(x0, v0, accPts, duration, dt);

    // Update position chart
    posChart.data.datasets[0].data = tArr.map((t, i) => ({ x: t, y: xArr[i] }));
    document.getElementById('posContainer').style.display = showPos ? 'block' : 'none';
    posChart.update();

    // Update velocity chart
    velChart.data.datasets[0].data = tArr.map((t, i) => ({ x: t, y: vArr[i] }));
    document.getElementById('velContainer').style.display = showVel ? 'block' : 'none';
    velChart.update();

    // Update acceleration chart
    accChart.data.datasets[0].data = accPts.map((a, i) => ({ x: i, y: a }));
    document.getElementById('accContainer').style.display = 'block';
    accChart.update();
  }

  function resetAll() {
    document.getElementById('x0').value = 0;
    document.getElementById('v0').value = 5;
    document.getElementById('duration').value = 5;
    document.getElementById('dt').value = 0.1;
    document.getElementById('showPos').checked = true;
    document.getElementById('showVel').checked = true;
    accPts = Array(6).fill(1);
    updateAll();
  }

  document.getElementById('updateBtn').onclick = updateAll;
  document.getElementById('resetBtn').onclick = resetAll;

  window.onload = () => {
    initCharts();
    resetAll();
  };
</script>
</body>
</html>
